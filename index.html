<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title id="pagina">Ficha de Personagem</title>

  <style>
    @font-face {
      font-family: "NewsflashBB";
      src: url(fonts/NewsflashBB.ttf);
    }

    @font-face {
      font-family: "comic";
      src: url(fonts/comic.ttf);
    }

    body {
      font-family: Arial, sans-serif;
      background-color:#ddd;
      margin: 0;
      padding: 20px;
    }

    .sheet {
      max-width: 1000px;
      margin-left: auto;
      margin-bottom: auto;
      margin-right: auto;
      margin-top: 70px;
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
    }

    h1 {
      text-align: left;
      margin-bottom: 2px;
      margin-top: 2px;
      font-family: NewsflashBB;
      color:rgb(122, 179, 225);
      font-weight: normal;
    }

    input {
      font-family: comic;
    }

    .bloco {
      display: grid;
      border: 2px solid rgb(90, 123, 254);
      border-radius: 15px;
      margin: 5px;
    }

    .header-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 10px;
    }

    .habilities-skills-adv {
      grid-template-columns: 25% 30% 43%;
      border: none;
      gap: 12px;
      align-items: start;
      justify-items: center;
    }

    .habilities {
      grid-template-columns: repeat(2, 1fr);
      gap: 2px;
      padding: 10px;
      align-items: center;
      justify-items: center;
    }

    .defenses {
      grid-template-columns: 44% 15% 15% 16% 10%;
      gap: 2px;
      padding: 10px;
      align-items: center;
    }

    .skills {
      /* grid-template-columns: 34% 14% 14% 14% 14% 10%; */
      gap: 2px;
      align-items: center;
      padding: 10px;
      justify-items: center;
    }

    table {
      border-spacing: 0px;
    }

    th{
      font-weight: normal;
    }

    .normal-text {
      font-family: NewsflashBB;
      color: black;
    }

    .small-number input {
      padding: 1px;
      width: 100%;
      box-sizing: border-box;
      font-size: 13px;
      font-family: NewsflashBB;
      color: rgb(90, 123, 254);
      text-align:center;
      border:none;
    }

    .field {
      display: flex;
      flex-direction: column;
    }

    .field label {
      font-size: 15px;
      font-family: NewsflashBB;
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .field input {
      padding: 1px;
      width: 100%;
      box-sizing: border-box;
      font-size: 14px;
    }

    .stat {
      display: block;
    }

    .stat input {
      background-color: rgba(123,181,238,0.5);
      border-radius: 5px;
      border: none;
      width: 100%;
      padding: 1px;
      box-sizing: border-box;
      text-align: center;
    }

    .hability label {
      font-size: 20px;
      font-family: NewsflashBB;
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .hability input {
      font-size: 25px;
      max-width: 70px;
    }

    .sub-hab label {
      font-size: 15px;
      font-family: NewsflashBB;
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .sub-hab input {
      padding: 1px;
      width: 100%;
      box-sizing: border-box;
      font-size: 15px;
      text-align:center;
      max-width: 70px;
      border: 2px solid rgb(123,181,238);
    }

    .outros {
      justify-self: center;
    }

    .outros input {
      font-size: 15px;
      max-width: 30px;
    }

    .outros label {
      font-family: NewsflashBB;
      font-size: 12px;
    }

    /* Fields that should span more columns */
    .span-2 {
      grid-column: span 2;
    }

    .span-3 {
      grid-column: span 3;
    }

    .span-4 {
      grid-column: span 4;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    #top-nav-bar {
      height: 0;
      display: block;
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 100;
      margin-left: auto;
      margin-right: auto;
      background-color: #000;
    }

    #top-nav-bar > #pagetop {
      position: absolute;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0;
      height: 56px;
      top: 0;
      left: 0;
      width: 100%;
      right: 0;
      max-width: 1750px;
      margin-left: auto;
      margin-right: auto;
    }

    #top-nav-bar::before {
      display: block;
      content: " ";
      z-index: -1;
      position: fixed;
      width: 100%;
      height: 56px;
      left: 0;
      top: 0;
      background-color: black;
    }

    .botao {
      margin: 10px;
      padding: 8px 16px;
      background-color: white;
      color: black;
      border-radius: 5px;
      vertical-align: middle;
      cursor: pointer;
    }

    .botao-img {
      background: #fff;
      border: 2px solid #fff;
      padding: 0;
      cursor: pointer;
      border: 2px solid #fff;
      width: 35px;
      height: 35px;
      border-radius: 5px;
    }

    .botao-img img {
      width: 30;
      height: 30px;
      background-color: #fff;
    }

  </style>
</head>
<body>

  <div id="top-nav-bar">
    <div id="pagetop">
      <img src="img/hoffens_logo_cheia_invertida.png" style="width: 54px; height: 50px; padding: 10px;">

      <button onclick="salvarFicha()" class="botao-img">
        <img src="img/save.png" title="Salvar Ficha">
      </button>

      <select id="listaFichas" onchange="carregarFicha(this.value)" class="botao">
        <option value="" id="opcaoPersonagem">— selecionar personagem —</option>
      </select>

      <button onclick="deletarFicha()" class="botao-img">
        <img src="img/delete.png" title="Apagar Ficha">
      </button>

      <button onclick="exportarFicha()" class="botao-img">
        <img src="img/download.png" title="Baixar Ficha">
      </button>

      <input type="file" accept=".json" onchange="importarFicha(event)" class="botao">

      <button onclick="limparFicha()" class="botao-img">
        <img src="img/erase.png" title="Limpar Ficha">
      </button>

      <input type="file" accept="application/pdf" onchange="importarPDF(event)">

    </div>
  </div>

  <div class="sheet">

    <div class="bloco header-grid">

      <div class="field span-2">
        <label for="personagem">Personagem</label>
        <input type="text" id="personagem">
      </div>

      <div class="field span-2">
        <label for="jogador">Jogador</label>
        <input type="text" id="jogador">
      </div>

      <div class="field">
        <label for="totalPontos">Total de Pontos</label>
        <input type="number" id="totalPontos">
      </div>

      <div class="field dependente">
        <label for="nivelPoder">Nivel de Poder</label>
        <input type="number" id="nivelPoder">
      </div>

      <div class="field">
        <label for="genero">Genero</label>
        <input type="text" id="genero">
      </div>

      <div class="field">
        <label for="idade">Idade</label>
        <input type="number" id="idade">
      </div>

      <div class="field">
        <label for="altura">Altura</label>
        <input type="text" id="altura">
      </div>

      <div class="field">
        <label for="peso">Peso</label>
        <input type="text" id="peso">
      </div>

      <div class="field">
        <label for="olhos">Olhos</label>
        <input type="text" id="olhos">
      </div>

      <div class="field">
        <label for="cabelos">Cabelos</label>
        <input type="text" id="cabelos">
      </div>

      <div class="field span-2">
        <label for="grupo">Grupo Afiliado</label>
        <input type="text" id="grupo">
      </div>

      <div class="field span-2">
        <label for="base">Base de Operacoes</label>
        <input type="text" id="base">
      </div>

    </div>

    <div class="bloco habilities-skills-adv">
      
      <div class="bloco habilities">
        <h1>Habilidades</h1><br>
        <div class="hability stat">
          <label for="forca">Forca</label><br>
          <input class="dependente" type="number" id="forca" oninput="calcularCarga()">
        </div>

        <div class="sub-hab">
          <label for="carga">Carga</label><br>
          <input type="text" id="carga" readonly>
          <script>
            function calcularCarga() {
              const hab = parseInt(document.getElementById("forca").value, 10);
              let Forca = "---";

              if (hab === -5) {
                Forca = "1 Kg";
              } else if (hab === -4) {
                Forca = "2 Kg";
              } else if (hab === -3) {
                Forca = "4 Kg";
              } else if (hab === -2) {
                Forca = "6 Kg";
              } else if (hab === -1) {
                Forca = "8 Kg";
              } else if (hab === 0) {
                Forca = "10 Kg";
              } else if (hab === 1) {
                Forca = "20 Kg";
              } else if (hab === 2) {
                Forca = "30 Kg";
              } else if (hab === 3) {
                Forca = "40 Kg";
              } else if (hab === 4) {
                Forca = "50 Kg";
              } else if (hab === 5) {
                Forca = "100 Kg";
              } else if (hab === 6) {
                Forca = "120 Kg";
              } else if (hab === 7) {
                Forca = "140 Kg";
              } else if (hab === 8) {
                Forca = "160 Kg";
              } else if (hab === 9) {
                Forca = "180 Kg";
              } else if (hab === 10) {
                Forca = "400 Kg";
              } else if (hab === 11) {
                Forca = "500 Kg";
              } else if (hab === 12) {
                Forca = "600 Kg";
              } else if (hab === 13) {
                Forca = "700 Kg";
              } else if (hab === 14) {
                Forca = "800 Kg";
              } else if (hab === 15) {
                Forca = "1,6 ton";
              } else if (hab === 16) {
                Forca = "1,8 ton";
              } else if (hab === 17) {
                Forca = "2 ton";
              } else if (hab === 18) {
                Forca = "2,2 ton";
              } else if (hab === 19) {
                Forca = "2,4 ton";
              } else if (hab === 20) {
                Forca = "5 ton";
              } else if (hab === 21) {
                Forca = "5,5 ton";
              } else if (hab === 22) {
                Forca = "6 ton";
              } else if (hab === 23) {
                Forca = "6,5 ton";
              } else if (hab === 24) {
                Forca = "7 ton";
              } else if (hab === 25) {
                Forca = "15 ton";
              } else if (hab === 26) {
                Forca = "16 ton";
              } else if (hab === 27) {
                Forca = "17 ton";
              } else if (hab === 28) {
                Forca = "18 ton";
              } else if (hab === 29) {
                Forca = "19 ton";
              } else if (hab === 30) {
                Forca = "50 ton";
              }

              document.getElementById("carga").value = Forca;
            }
          </script>
        </div>

        <div class="hability stat">
          <label for="agilidade">Agilidade</label><br>
          <input class="dependente" type="number" id="agilidade" oninput="calcularDeslocamento()">
        </div>

        <div class="sub-hab">
          <label for="deslocamento">Deslocamento</label><br>
          <input type="text" id="deslocamento" readonly>
          <script>
            function calcularDeslocamento() {
              const agilidade = parseInt(document.getElementById("agilidade").value, 10);
              let deslocamento = 0;
              if(agilidade >= 0){
                deslocamento = (agilidade + 1)*1.5;
              }else if(agilidade < 0){
                deslocamento = Math.pow(2, agilidade+1);
                deslocamento = deslocamento.toFixed(2)
              }
              document.getElementById("deslocamento").value = deslocamento + " m";
            }
          </script>
        </div>

        <div class="hability stat">
          <label for="luta">Luta</label><br>
          <input class="dependente" type="number" id="luta">
        </div>

        <div class="hability stat">
          <label for="vigor">Vigor</label><br>
          <input class="dependente" type="number" id="vigor">
        </div>

        <div class="hability stat">
          <label for="intelecto">Intelecto</label><br>
          <input class="dependente" type="number" id="intelecto">
        </div>

        <div class="hability stat">
          <label for="prontidao">Prontidao</label><br>
          <input class="dependente" type="number" id="prontidao">
        </div>

        <div class="hability stat">
          <label for="destreza">Destreza</label><br>
          <input class="dependente" type="number" id="destreza">
        </div>

        <div class="hability stat">
          <label for="presenca">Presenca</label><br>
          <input class="dependente" type="number" id="presenca">
        </div>

      </div>

      <div class="bloco defenses">
        <h1>Defesa</h1>
        <p class="normal-text" style="font-size: 13px;text-align: center;">Total</p>
        <p class="normal-text" style="font-size: 13px;text-align: center;">Grad. Defesa</p>
        <p class="normal-text" style="font-size: 13px;text-align: center;">Outros</p>
        <p class="normal-text" style="font-size: 13px;text-align: center;color:rgb(90, 123, 254);">
          Max
        </p>

        <span class="normal-text" style="font-size: 20px;">
          <span style="font-size: 13px;">(Agi)</span> Esquiva
        </span>
        <div class="sub-hab">
          <input type="number" id="esquiva-total" readonly>
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="esquiva-grad">
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="esquiva-outros">
        </div>
        <div class="small-number">
          <input type="number" id="esquiva-max" readonly>
        </div>

        <span class="normal-text" style="font-size: 20px;">
          <span style="font-size: 13px;">(Lut)</span> Aparar
        </span>
        <div class="sub-hab">
          <input type="number" id="aparar-total" readonly>
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="aparar-grad">
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="aparar-outros">
        </div>
        <div class="small-number">
          <input type="number" id="aparar-max" readonly>
        </div>

        <span class="normal-text" style="font-size: 20px;">
          <span style="font-size: 13px;">(Vig)</span> Fortitude
        </span>
        <div class="sub-hab">
          <input type="number" id="fortitude-total" readonly>
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="fortitude-grad">
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="fortitude-outros">
        </div>
        <div class="small-number">
          <input type="number" id="fortitude-max" readonly>
        </div>

        <span class="normal-text" style="font-size: 20px;">
          <span style="font-size: 13px;">(Vig)</span> Resistencia
        </span>
        <div class="sub-hab">
          <input type="number" id="resistencia-total" readonly>
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="resistencia-grad">
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="resistencia-outros">
        </div>
        <div class="small-number">
          <input type="number" id="resistencia-max" readonly>
        </div>

        <span class="normal-text" style="font-size: 20px;">
          <span style="font-size: 13px;">(Pro)</span> Vontade
        </span>
        <div class="sub-hab">
          <input type="number" id="vontade-total" readonly>
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="vontade-grad">
        </div>
        <div class="stat">
          <input class="dependente" type="number" id="vontade-outros">
        </div>
        <div class="small-number">
          <input type="number" id="vontade-max" readonly>
        </div>

      
      </div>

      <div class="bloco skills">
        <input
          type="text"
          id="tableFilter"
          placeholder="Buscar Perícia..."
          style="border: 2px solid rgb(123,181,238);
                 border-radius: 5px;"
          oninput="filtrarTabela('skills-table')"
        >

        <table id="skills-table", style="width: 100%;">
          <tr class="header-row">
            <th style="width: 34%;">
              <h1>Pericias</h1>
            </th>
            <th>
              <p class="normal-text" style="font-size: 15px; text-align: center;">Total</p>
            </th>
            <th style="width: 14%;">
              <p class="normal-text" style="font-size: 15px; text-align: center;">Mod. de Habilidade</p>
            </th>
            <th style="width: 14%;">
              <p class="normal-text" style="font-size: 15px; text-align: center;">Grad. na Pericia</p>
            </th>
            <th style="width: 14%;">
              <p class="normal-text" style="font-size: 15px; text-align: center;">Outros</p>
            </th>
            <th style="width: 10%;">
              <p class="normal-text" style="font-size: 13px; text-align: center; color: rgb(90, 123, 254);">Max</p>
            </th>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Agi)</span> Acrobacia*
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="acrobacia-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="acrobacia-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="acrobacia-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="acrobacia-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="acrobacia-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(For)</span> Atletismo
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="atletismo-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="atletismo-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="atletismo-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="atletismo-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="atletismo-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <div class="field">
                <label for="ccc1"><span style="font-size: 13px;">(Lut)</span> Combate corpo-a-corpo</label>
                <input type="text" id="ccc1">
                <input type="text" id="ccc2">
                <input type="text" id="ccc3">
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <br>
                <input type="number" id="ccc1-total" readonly>
                <input type="number" id="ccc2-total" readonly>
                <input type="number" id="ccc3-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <br>
                <input class="dependente" type="number" id="ccc1-hab" style="margin: 2px;" readonly>
                <input class="dependente" type="number" id="ccc2-hab" style="margin: 2px;" readonly>
                <input class="dependente" type="number" id="ccc3-hab" style="margin: 2px;" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <br>
                <input class="dependente" type="number" id="ccc1-grad" style="margin: 2px;">
                <input class="dependente" type="number" id="ccc2-grad" style="margin: 2px;">
                <input class="dependente" type="number" id="ccc3-grad" style="margin: 2px;">
              </div>
            </td>
            <td>
              <div class="stat">
                <br>
                <input class="dependente" type="number" id="ccc1-outros" style="margin: 2px;">
                <input class="dependente" type="number" id="ccc2-outros" style="margin: 2px;">
                <input class="dependente" type="number" id="ccc3-outros" style="margin: 2px;">
              </div>
            </td>
            <td>
              <div class="small-number">
                <br>
                <input type="number" id="ccc1-max" readonly>
                <input type="number" id="ccc2-max" readonly>
                <input type="number" id="ccc3-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Pre)</span> Enganacao
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="enganacao-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="enganacao-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="enganacao-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="enganacao-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="enganacao-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <div class="field">
                <label for="especialidade1"><span style="font-size: 13px;">(Int)</span> Especialidade*</label>
                <input type="text" id="especialidade1">
                <input type="text" id="especialidade2">
                <input type="text" id="especialidade3">
                <input type="text" id="especialidade4">
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <br>
                <input type="number" id="especialidade1-total" readonly>
                <input type="number" id="especialidade2-total" readonly>
                <input type="number" id="especialidade3-total" readonly>
                <input type="number" id="especialidade4-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <br>
                <input class="dependente" type="number" id="especialidade1-hab" style="margin: 2px;" readonly>
                <input class="dependente" type="number" id="especialidade2-hab" style="margin: 2px;" readonly>
                <input class="dependente" type="number" id="especialidade3-hab" style="margin: 2px;" readonly>
                <input class="dependente" type="number" id="especialidade4-hab" style="margin: 2px;" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <br>
                <input class="dependente" type="number" id="especialidade1-grad" style="margin: 2px;">
                <input class="dependente" type="number" id="especialidade2-grad" style="margin: 2px;">
                <input class="dependente" type="number" id="especialidade3-grad" style="margin: 2px;">
                <input class="dependente" type="number" id="especialidade4-grad" style="margin: 2px;">
              </div>
            </td>
            <td>
              <div class="stat">
                <br>
                <input class="dependente" type="number" id="especialidade1-outros" style="margin: 2px;">
                <input class="dependente" type="number" id="especialidade2-outros" style="margin: 2px;">
                <input class="dependente" type="number" id="especialidade3-outros" style="margin: 2px;">
                <input class="dependente" type="number" id="especialidade4-outros" style="margin: 2px;">
              </div>
            </td>
            <td>
              <div class="small-number">
                <br>
                <input type="number" id="especialidade1-max" readonly>
                <input type="number" id="especialidade2-max" readonly>
                <input type="number" id="especialidade3-max" readonly>
                <input type="number" id="especialidade4-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Agi)</span> Furtividade
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="furtividade-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="furtividade-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="furtividade-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="furtividade-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="furtividade-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Pre)</span> Intimidacao
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="intimidacao-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="intimidacao-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="intimidacao-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="intimidacao-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="intimidacao-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Pro)</span> Intuicao
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="intuicao-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="intuicao-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="intuicao-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="intuicao-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="intuicao-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Int)</span> Investigacao*
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="investigacao-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="investigacao-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="investigacao-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="investigacao-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="investigacao-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Pro)</span> Percepcao
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="percepcao-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="percepcao-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="percepcao-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="percepcao-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="percepcao-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <div class="field">
                <label for="ccc1"><span style="font-size: 13px;">(Des)</span> Combate a Distancia</label>
                <input type="text" id="cad1">
                <input type="text" id="cad2">
                <input type="text" id="cad3">
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <br>
                <input type="number" id="cad1-total" readonly>
                <input type="number" id="cad2-total" readonly>
                <input type="number" id="cad3-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <br>
                <input class="dependente" type="number" id="cad1-hab" style="margin: 2px;" readonly>
                <input class="dependente" type="number" id="cad2-hab" style="margin: 2px;" readonly>
                <input class="dependente" type="number" id="cad3-hab" style="margin: 2px;" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <br>
                <input class="dependente" type="number" id="cad1-grad" style="margin: 2px;">
                <input class="dependente" type="number" id="cad2-grad" style="margin: 2px;">
                <input class="dependente" type="number" id="cad3-grad" style="margin: 2px;">
              </div>
            </td>
            <td>
              <div class="stat">
                <br>
                <input class="dependente" type="number" id="cad1-outros" style="margin: 2px;">
                <input class="dependente" type="number" id="cad2-outros" style="margin: 2px;">
                <input class="dependente" type="number" id="cad3-outros" style="margin: 2px;">
              </div>
            </td>
            <td>
              <div class="small-number">
                <br>
                <input type="number" id="cad1-max" readonly>
                <input type="number" id="cad2-max" readonly>
                <input type="number" id="cad3-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Pre)</span> Persuasao
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="persuasao-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="persuasao-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="persuasao-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="persuasao-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="persuasao-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Des)</span> Prestidigitacao*
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="prestidigitacao-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="prestidigitacao-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="prestidigitacao-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="prestidigitacao-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="prestidigitacao-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Int)</span> Tecnologia*
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="tecnologia-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="tecnologia-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="tecnologia-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="tecnologia-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="tecnologia-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Int)</span> Tratamento*
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="tratamento-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="tratamento-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="tratamento-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="tratamento-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="tratamento-max" readonly>
              </div>
            </td>
          </tr>

          <tr>
            <td>
              <span class="normal-text" style="font-size: 20px; justify-self: left;">
                <span style="font-size: 13px;">(Des)</span> Veiculos*
              </span>
            </td>
            <td>
              <div class="sub-hab">
                <input type="number" id="veiculos-total" readonly>
              </div>
            </td>
            <td>
              <div class="sub-hab">
                <input class="dependente" type="number" id="veiculos-hab" readonly>
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="veiculos-grad">
              </div>
            </td>
            <td>
              <div class="stat">
                <input class="dependente" type="number" id="veiculos-outros">
              </div>
            </td>
            <td>
              <div class="small-number">
                <input type="number" id="veiculos-max" readonly>
              </div>
            </td>
          </tr>
          
        </table>
      </div>
    </div>
  </div>

  <script>    
    
    function exportarFicha() {
      const dados = {};
      document.querySelectorAll("input, textarea, select").forEach(el => {
        if (el.id) {
          dados[el.id] = el.value;
        }
      });

      const blob = new Blob(
        [JSON.stringify(dados, null, 2)],
        { type: "application/json" }
      );

      const nome = document.getElementById("personagem").value;

      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `ficha-${nome}.json`;
      link.click();
    }

    function importarFicha(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        const dados = JSON.parse(reader.result);

        Object.keys(dados).forEach(id => {
          const el = document.getElementById(id);
          if (el) el.value = dados[id];
        });

        // recalcula campos automáticos
        if (typeof recalcularTudo === "function") {
          recalcularTudo();
        }

        const nome = document.getElementById("personagem").value;
        document.getElementById("pagina").innerHTML = nome;
      };
      
      reader.readAsText(file);
    }

    function getIndex() {
      return JSON.parse(localStorage.getItem("fichas:index")) || [];
    }

    function saveIndex(index) {
      localStorage.setItem("fichas:index", JSON.stringify(index));
    }

    function carregarIndex() {
      const select = document.getElementById("listaFichas");
      const index = JSON.parse(localStorage.getItem("fichas:index")) || [];

      // limpa o select
      select.innerHTML = "";

      // opção padrão
      const placeholder = document.createElement("option");
      placeholder.value = "";
      placeholder.textContent = "— selecionar personagem —";
      select.appendChild(placeholder);

      // adiciona as fichas
      index.forEach(nome => {
        const option = document.createElement("option");
        option.value = nome;
        option.textContent = nome;
        select.appendChild(option);
      });
    }

    function salvarFicha() {
      const dados = {};

      document.querySelectorAll("input, textarea, select").forEach(el => {
        if (el.id) dados[el.id] = el.value;
      });

      const nome = document.getElementById("personagem").value;

      localStorage.setItem(`ficha:${nome}`, JSON.stringify(dados));

      document.getElementById("pagina").innerHTML = nome;

      const index = getIndex();
      if (!index.includes(nome)) {
        index.push(nome);
        saveIndex(index);
      }

      carregarIndex();
    }

    function carregarFicha(nome) {
      const dados = JSON.parse(localStorage.getItem(`ficha:${nome}`));
      if (!dados) return;

      Object.keys(dados).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = dados[id];
      });

      document.getElementById("pagina").innerHTML = nome;

    }

    function deletarFicha() {

      const nome = document.getElementById("personagem").value;

      localStorage.removeItem(`ficha:${nome}`);

      const index = getIndex().filter(n => n !== nome);
      saveIndex(index);

      carregarIndex();
    }

    function limparFicha() {
      // limpa inputs, selects e textareas
      document.querySelectorAll("input, textarea, select").forEach(el => {

        // não limpa botões, file inputs ou readonly calculados
        if (
          el.type === "button" ||
          el.type === "submit" ||
          el.type === "file" ||
          el.readOnly
        ) return;

        if (el.tagName === "SELECT") {
          el.selectedIndex = 0;
        } else {
          el.value = "";
        }
      });

      // limpa seleção de ficha
      const lista = document.getElementById("listaFichas");
      if (lista) lista.value = "";

      // recalcula campos automáticos
      if (typeof recalcularTudo === "function") {
        recalcularTudo();
      }

      document.getElementById("pagina").innerHTML = "Ficha de Personagem";
    }

    carregarIndex();

    function calcularTotalAtributo(hab, grad, def, ot){
      const habilidade = Number(document.getElementById(hab).value) || 0;
      const graduacao = Number(document.getElementById(grad).value) || 0;
      const outros = Number(document.getElementById(ot).value) || 0;

      document.getElementById(def).value = habilidade + graduacao + outros
    }

    function copiaValor(fonte, destino) {
      const valorFonte = Number(document.getElementById(fonte).value) || 0;
      document.getElementById(destino).value = valorFonte;
    }

    function npLimit(limitWith, limitedStat){
      const NP = Number(document.getElementById("nivelPoder").value) || 0;
      const res = document.getElementById(limitWith).value;

      document.getElementById(limitedStat).value = parseInt(2*NP-res);
    }

    function limitePericia(pericia){
      const NP = Number(document.getElementById("nivelPoder").value) || 0;
      const hab = Number(document.getElementById(`${pericia}-hab`).value) || 0;
      const outros = Number(document.getElementById(`${pericia}-outros`).value) || 0;

      let limite = NP+10 - hab - outros;
      document.getElementById(`${pericia}-max`).value = limite;
    }

    function limiteCombate(acerto){
      const NP = Number(document.getElementById("nivelPoder").value) || 0;
      const hab = Number(document.getElementById(`${acerto}-hab`).value) || 0;
      const outros = Number(document.getElementById(`${acerto}-outros`).value) || 0;

      let limite = NP*2 - hab - outros;
      document.getElementById(`${acerto}-max`).value = limite;
    }

    function limitResistencia(){
      const NP = Number(document.getElementById("nivelPoder").value) || 0;
      const aparar = Number(document.getElementById("aparar-total").value) || 0;
      const esquiva = Number(document.getElementById("esquiva-total").value) || 0;
      let valorDefesa = 0;
      if (esquiva > aparar) {
        valorDefesa= esquiva;
      }
      else{
        valorDefesa = aparar;
      }

      document.getElementById("resistencia-max").value = 2*NP-valorDefesa;
    }

    function recalcularTudo() {
      calcularTotalAtributo("agilidade","esquiva-grad","esquiva-total","esquiva-outros");
      calcularTotalAtributo("luta","aparar-grad","aparar-total","aparar-outros");
      calcularTotalAtributo("vigor","fortitude-grad","fortitude-total","fortitude-outros");
      calcularTotalAtributo("vigor","resistencia-grad","resistencia-total","resistencia-outros");
      calcularTotalAtributo("prontidao","vontade-grad","vontade-total","vontade-outros");
      npLimit("resistencia-total","esquiva-max");
      npLimit("resistencia-total","aparar-max");
      npLimit("fortitude-total","vontade-max");
      npLimit("vontade-total","fortitude-max");
      npLimit("fortitude-total","vontade-max");
      limitResistencia();
      
      const pericias = {
        acrobacia: "agilidade",
        atletismo: "forca",

        ccc1: "luta",        // Combate Corpo-a-Corpo
        ccc2: "luta",
        ccc3: "luta",

        cad1: "destreza",   // Combate à Distância
        cad2: "destreza",
        cad3: "destreza",

        enganacao: "presenca",

        especialidade1: "intelecto",
        especialidade2: "intelecto",
        especialidade3: "intelecto",
        especialidade4: "intelecto",

        furtividade: "agilidade",
        intimidacao: "presenca",
        intuicao: "prontidao",
        investigacao: "intelecto",
        percepcao: "prontidao",
        persuasao: "presenca",
        prestidigitacao: "destreza",
        tecnologia: "intelecto",
        tratamento: "intelecto",
        veiculos: "destreza"
      };

      Object.entries(pericias).forEach(([pericia, atributo]) => {
        copiaValor(atributo, `${pericia}-hab`);

        if(["ccc1","ccc2","ccc3","cad1","cad2","cad3"].includes(pericia)){
          limiteCombate(pericia);
        } else {
          limitePericia(pericia);
        }
        
        calcularTotalAtributo(
          `${pericia}-hab`,
          `${pericia}-grad`,
          `${pericia}-total`,
          `${pericia}-outros`,
          atributo
        );
      });

    }

    function filtrarTabela(tabela) {
      const filtro = document.getElementById("tableFilter").value.toLowerCase();
      const linhas = document.querySelectorAll(`#${tabela} tbody tr`);

      linhas.forEach(linha => {
        if (linha.classList.contains("header-row")) {
          linha.style.display = "";
          return;
        }

        const texto = linha.textContent.toLowerCase();
        linha.style.display = texto.includes(filtro) ? "" : "none";
      });
    }
    
    document.querySelectorAll(".dependente").forEach(input => {
      input.addEventListener("input", recalcularTudo);
    });
    
  </script>
</body>
</html>
